<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sirros - An√°lise de Qualidade da Fibra</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif}
    body{background:#1a2332;color:#fff;min-height:100vh}
    .header{background:#0f1823;padding:15px 30px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #2a3547}
    .logo{font-size:24px;font-weight:300;letter-spacing:2px}
    .nav-info{display:flex;align-items:center;gap:20px;font-size:14px;color:#8892a0}
    .sidebar{width:260px;background:#0f1823;height:calc(100vh - 60px);position:fixed;padding:20px;overflow-y:auto}
    .main-content{margin-left:260px;padding:30px}
    .page-title{font-size:32px;font-weight:300;margin-bottom:30px}
    .menu-section{margin-bottom:30px}
    .menu-title{font-size:11px;text-transform:uppercase;color:#8892a0;margin-bottom:15px;letter-spacing:1px}
    .menu-item{padding:12px 15px;border-radius:5px;cursor:pointer;transition:.3s;margin-bottom:5px;display:flex;align-items:center;gap:10px;color:#d1d5db}
    .menu-item:hover,.menu-item.active{background:#1a2332;color:#00d4ff}
    .metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}
    .metric-card{background:#0f1823;padding:25px;border-radius:10px;border:1px solid #2a3547}
    .metric-card.red{border-left:4px solid #ef4444}.metric-card.blue{border-left:4px solid #3b82f6}.metric-card.yellow{border-left:4px solid #eab308}.metric-card.green{border-left:4px solid #10b981}
    .metric-label{font-size:12px;color:#8892a0;margin-bottom:10px;text-transform:uppercase}
    .metric-value{font-size:28px;font-weight:600}
    .metric-change{font-size:14px;margin-top:5px;opacity:.8}
    .data-table{background:#0f1823;border-radius:10px;overflow:hidden;margin-bottom:30px;border:1px solid #2a3547}
    table{width:100%;border-collapse:collapse}
    th{background:#1a2332;padding:15px;text-align:left;font-weight:500;color:#8892a0;font-size:12px;text-transform:uppercase}
    td{padding:15px;border-top:1px solid #2a3547}
    tr:hover{background:#1a2332}
    .quality-indicator{display:inline-block;padding:4px 12px;border-radius:20px;font-size:12px}
    .quality-high{background:#10b98133;color:#10b981}.quality-medium{background:#eab30833;color:#eab308}.quality-low{background:#ef444433;color:#ef4444}
    .charts-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(500px,1fr));gap:20px;margin-bottom:30px}
    .chart-card{background:#0f1823;padding:25px;border-radius:10px;border:1px solid #2a3547;min-height:320px}
    .chart-card canvas{display:block;width:100% !important;height:260px !important}
    .chart-title{font-size:16px;margin-bottom:20px;color:#d1d5db}
    .simulator-card{background:#0f1823;padding:30px;border-radius:10px;border:1px solid #2a3547;margin-bottom:30px}
    .simulator-title{font-size:20px;margin-bottom:25px;display:flex;align-items:center;gap:10px}
    .input-group{margin-bottom:20px}
    .input-label{display:block;margin-bottom:8px;font-size:14px;color:#8892a0}
    .slider-container{display:flex;align-items:center;gap:15px}
    input[type="range"]{flex:1;height:6px;background:#2a3547;border-radius:3px;outline:none;-webkit-appearance:none}
    input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:18px;height:18px;background:#00d4ff;border-radius:50%;cursor:pointer}
    .slider-value{min-width:60px;text-align:right;font-weight:600;color:#00d4ff}
    select{width:100%;padding:10px 15px;background:#1a2332;border:1px solid #2a3547;border-radius:5px;color:#fff;font-size:14px;cursor:pointer}
    .prediction-results{background:#1a2332;padding:20px;border-radius:10px;margin-top:25px}
    .result-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid #2a3547}
    .result-item:last-child{border-bottom:none}
    .result-label{color:#8892a0}
    .result-value{font-size:18px;font-weight:600}
    .result-change{font-size:14px;margin-left:10px}
    .positive{color:#10b981}.negative{color:#ef4444}
    .btn{padding:12px 30px;background:#00d4ff;color:#0f1823;border:none;border-radius:5px;font-weight:600;cursor:pointer;transition:.3s}
    .btn:hover{background:#00a8cc;transform:translateY(-2px)}
    .btn-secondary{background:#2a3547;color:#fff}.btn-secondary:hover{background:#3a4557}
    .flag-brazil{width:20px;height:14px;background:linear-gradient(to bottom,#009c3b 0%,#009c3b 50%,#ffdf00 50%,#ffdf00 100%);border-radius:2px;display:inline-block}
    .optimization-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin-top:30px}
    .optimization-card{background:#1a2332;padding:25px;border-radius:10px;border:2px solid #2a3547;transition:.3s}
    .optimization-card.recommended{border-color:#10b981;position:relative}
    .recommended-badge{position:absolute;top:-12px;right:20px;background:#10b981;color:#fff;padding:4px 16px;border-radius:20px;font-size:12px;font-weight:600}
    .content-section{display:none}.content-section.active{display:block}
    .timeline-container{background:#0f1823;padding:30px;border-radius:10px;border:1px solid #2a3547;margin-bottom:30px}
    .timeline-item{display:flex;gap:20px;padding:20px 0;border-bottom:1px solid #2a3547}
    .timeline-date{min-width:100px;color:#8892a0;font-size:14px}
    .timeline-content{flex:1}
    .timeline-title{font-size:16px;margin-bottom:5px}
    .timeline-description{color:#8892a0;font-size:14px}
    .filter-bar{display:flex;gap:15px;margin-bottom:30px;flex-wrap:wrap}
    .filter-item{display:flex;flex-direction:column;gap:5px}
    .filter-label{font-size:12px;color:#8892a0;text-transform:uppercase}
    .report-card{background:#0f1823;padding:25px;border-radius:10px;border:1px solid #2a3547;margin-bottom:20px;cursor:pointer;transition:.3s}
    .report-card:hover{border-color:#00d4ff;transform:translateX(5px)}
    .report-title{font-size:18px;margin-bottom:10px}
    .report-meta{display:flex;gap:20px;color:#8892a0;font-size:14px}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
    .pulse{animation:pulse 2s infinite}
    .alert{padding:15px 20px;border-radius:5px;margin-bottom:20px;display:flex;align-items:center;gap:10px}
    .alert-info{background:#1e40af33;border:1px solid #1e40af;color:#60a5fa}
    .alert-success{background:#10b98133;border:1px solid #10b981;color:#10b981}
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">‚ö° sirros</div>
    <div class="nav-info">
      <span>üîÑ Cotton Quality Predictor</span>
      <span>üìç <span class="flag-brazil"></span> Brasil</span>
      <span>üîç</span>
    </div>
  </div>

  <div class="sidebar">
    <div class="menu-section">
      <div class="menu-title">AN√ÅLISE DE QUALIDADE</div>
      <div class="menu-item active" onclick="showSection(event,'dashboard')">üìä Dashboard</div>
      <div class="menu-item" onclick="showSection(event,'historico')">üìà An√°lise Hist√≥rica</div>
      <div class="menu-item" onclick="showSection(event,'predicao')">üîÆ Predi√ß√£o</div>
      <div class="menu-item" onclick="showSection(event,'otimizacao')">‚öôÔ∏è Otimiza√ß√£o</div>
    </div>
    <div class="menu-section">
      <div class="menu-title">RELAT√ìRIOS</div>
      <div class="menu-item" onclick="showSection(event,'relatorio-qualidade')">üìÑ Hist√≥rico de Qualidade</div>
      <div class="menu-item" onclick="showSection(event,'relatorio-solo')">üìä An√°lise Solo-Fibra</div>
      <div class="menu-item" onclick="showSection(event,'relatorio-roi')">üí∞ ROI por Fazenda</div>
    </div>
  </div>

  <div class="main-content">
    <!-- Dashboard -->
    <div id="dashboard-section" class="content-section active">
      <h1 class="page-title">Dashboard de Qualidade da Fibra</h1>

      <div class="metrics-grid">
        <div class="metric-card red">
          <div class="metric-label">Qualidade M√©dia Atual</div>
          <div class="metric-value">76.5%</div>
          <div class="metric-change">Baseline hist√≥rico</div>
        </div>
        <div class="metric-card blue">
          <div class="metric-label">Qualidade Predita</div>
          <div class="metric-value">84.2%</div>
          <div class="metric-change positive">‚Üë 7.7% de melhoria</div>
        </div>
        <div class="metric-card yellow">
          <div class="metric-label">Economia Potencial</div>
          <div class="metric-value">R$ 248/ha</div>
          <div class="metric-change">Em insumos otimizados</div>
        </div>
        <div class="metric-card green">
          <div class="metric-label">ROI Estimado</div>
          <div class="metric-value">342%</div>
          <div class="metric-change">Retorno sobre investimento</div>
        </div>
      </div>

      <div class="data-table">
        <table>
          <thead>
            <tr>
              <th>Fazenda</th><th>Talh√£o</th><th>N (kg/ha)</th><th>P (kg/ha)</th><th>K (kg/ha)</th>
              <th>Variedade</th><th>Comprimento (mm)</th><th>Resist√™ncia (gf/tex)</th><th>Micronaire</th><th>Qualidade</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Santa Helena</td><td>T-42</td><td>180</td><td>90</td><td>140</td><td>FM 985 GLT</td><td>29.8</td><td>31.5</td><td>4.2</td><td><span class="quality-indicator quality-high">Alta</span></td></tr>
            <tr><td>S√£o Jos√©</td><td>T-15</td><td>160</td><td>75</td><td>120</td><td>DP 1746 B2RF</td><td>28.5</td><td>29.8</td><td>4.5</td><td><span class="quality-indicator quality-medium">M√©dia</span></td></tr>
            <tr><td>Boa Vista</td><td>T-08</td><td>145</td><td>70</td><td>110</td><td>TMG 47 B2RF</td><td>27.2</td><td>28.3</td><td>4.8</td><td><span class="quality-indicator quality-low">Baixa</span></td></tr>
          </tbody>
        </table>
      </div>

      <div class="charts-container">
        <div class="chart-card">
          <div class="chart-title">Correla√ß√£o Solo-Fibra por Fazenda</div>
          <canvas id="correlationChart"></canvas>
        </div>
        <div class="chart-card">
          <div class="chart-title">Evolu√ß√£o da Qualidade</div>
          <canvas id="evolutionChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Hist√≥rico -->
    <div id="historico-section" class="content-section">
      <h1 class="page-title">An√°lise Hist√≥rica</h1>

      <div class="filter-bar">
        <div class="filter-item">
          <label class="filter-label">Fazenda</label>
          <select><option>Todas</option><option>Santa Helena</option><option>S√£o Jos√©</option><option>Boa Vista</option></select>
        </div>
        <div class="filter-item">
          <label class="filter-label">Per√≠odo</label>
          <select><option>√öltimos 12 meses</option><option>√öltimos 6 meses</option><option>√öltimos 3 meses</option><option>Safra 2024</option><option>Safra 2023</option></select>
        </div>
        <div class="filter-item">
          <label class="filter-label">Variedade</label>
          <select><option>Todas</option><option>FM 985 GLT</option><option>DP 1746 B2RF</option><option>TMG 47 B2RF</option></select>
        </div>
      </div>

      <div class="timeline-container">
        <h3 style="margin-bottom: 20px;">Eventos Significativos</h3>
        <div class="timeline-item">
          <div class="timeline-date">15/03/2024</div>
          <div class="timeline-content">
            <div class="timeline-title">Mudan√ßa de Manejo - Fazenda Santa Helena</div>
            <div class="timeline-description">Redu√ß√£o de 15% no nitrog√™nio resultou em melhoria de 3.2% na uniformidade da fibra</div>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-date">28/02/2024</div>
          <div class="timeline-content">
            <div class="timeline-title">Nova Variedade Implementada</div>
            <div class="timeline-description">FM 985 GLT substituiu TMG 44 em 40% da √°rea, aumento de 8% na resist√™ncia</div>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-date">10/01/2024</div>
          <div class="timeline-content">
            <div class="timeline-title">Otimiza√ß√£o de Irriga√ß√£o</div>
            <div class="timeline-description">Sistema de irriga√ß√£o por gotejamento aumentou comprimento m√©dio em 1.2mm</div>
          </div>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-title">Tend√™ncias de Qualidade por Par√¢metro</div>
        <canvas id="trendsChart"></canvas>
      </div>
    </div>

    <!-- Predi√ß√£o -->
    <div id="predicao-section" class="content-section">
      <h1 class="page-title">Predi√ß√£o de Qualidade</h1>

      <div class="alert alert-info">‚ÑπÔ∏è Use os controles abaixo para simular diferentes cen√°rios e ver as predi√ß√µes em tempo real</div>

      <div class="simulator-card">
        <div class="simulator-title">üî¨ Simulador Avan√ßado de Qualidade</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:30px;">
          <div>
            <h4 style="margin-bottom:20px;color:#8892a0;">Par√¢metros de Solo</h4>
            <div class="input-group">
              <label class="input-label">Nitrog√™nio (kg/ha)</label>
              <div class="slider-container">
                <input type="range" id="nitrogen-pred" min="100" max="250" value="150" oninput="updatePrediction()"/>
                <span class="slider-value" id="nitrogen-pred-value">150</span>
              </div>
            </div>
            <div class="input-group">
              <label class="input-label">F√≥sforo (kg/ha)</label>
              <div class="slider-container">
                <input type="range" id="phosphorus-pred" min="50" max="150" value="80" oninput="updatePrediction()"/>
                <span class="slider-value" id="phosphorus-pred-value">80</span>
              </div>
            </div>
            <div class="input-group">
              <label class="input-label">Pot√°ssio (kg/ha)</label>
              <div class="slider-container">
                <input type="range" id="potassium-pred" min="80" max="200" value="120" oninput="updatePrediction()"/>
                <span class="slider-value" id="potassium-pred-value">120</span>
              </div>
            </div>
            <div class="input-group">
              <label class="input-label">pH do Solo</label>
              <div class="slider-container">
                <input type="range" id="ph-pred" min="50" max="75" value="62" oninput="updatePrediction()"/>
                <span class="slider-value" id="ph-pred-value">6.2</span>
              </div>
            </div>
          </div>

          <div>
            <h4 style="margin-bottom:20px;color:#8892a0;">Par√¢metros de Manejo</h4>
            <div class="input-group">
              <label class="input-label">Variedade</label>
              <select id="variety-pred" onchange="updatePrediction()">
                <option value="FM985">FM 985 GLT</option>
                <option value="DP1746">DP 1746 B2RF</option>
                <option value="TMG47">TMG 47 B2RF</option>
                <option value="IMA2106">IMA 2106 GLT</option>
              </select>
            </div>
            <div class="input-group">
              <label class="input-label">Densidade de Plantio (plantas/ha)</label>
              <div class="slider-container">
                <input type="range" id="density-pred" min="80000" max="140000" value="110000" step="5000" oninput="updatePrediction()"/>
                <span class="slider-value" id="density-pred-value">110k</span>
              </div>
            </div>
            <div class="input-group">
              <label class="input-label">Irriga√ß√£o (mm/ciclo)</label>
              <div class="slider-container">
                <input type="range" id="irrigation-pred" min="400" max="800" value="600" step="50" oninput="updatePrediction()"/>
                <span class="slider-value" id="irrigation-pred-value">600</span>
              </div>
            </div>
          </div>
        </div>

        <div class="prediction-results" style="margin-top:30px;">
          <h3 style="margin-bottom:20px;">Resultados da Predi√ß√£o</h3>
          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:15px;">
            <div class="result-item"><span class="result-label">Comprimento</span><div><span class="result-value" id="length-pred-result">28.5</span> mm <span class="result-change positive" id="length-pred-change">‚Üë 2.3%</span></div></div>
            <div class="result-item"><span class="result-label">Resist√™ncia</span><div><span class="result-value" id="strength-pred-result">30.2</span> gf/tex <span class="result-change positive" id="strength-pred-change">‚Üë 4.1%</span></div></div>
            <div class="result-item"><span class="result-label">Micronaire</span><div><span class="result-value" id="micronaire-pred-result">4.3</span> <span class="result-change" id="micronaire-pred-change" style="color:#10b981;">Ideal</span></div></div>
            <div class="result-item"><span class="result-label">Uniformidade</span><div><span class="result-value" id="uniformity-pred-result">83.2</span>% <span class="result-change positive" id="uniformity-pred-change">‚Üë 1.8%</span></div></div>
          </div>
          <div style="margin-top:20px;padding-top:20px;border-top:1px solid #2a3547;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div>
                <div style="color:#8892a0;font-size:14px;">√çndice de Qualidade Geral</div>
                <div style="font-size:32px;font-weight:600;color:#00d4ff;">82.5%</div>
              </div>
              <button class="btn">Salvar Cen√°rio</button>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-title">An√°lise de Sensibilidade</div>
        <canvas id="sensitivityChart"></canvas>
      </div>
    </div>

    <!-- Otimiza√ß√£o -->
    <div id="otimizacao-section" class="content-section">
      <h1 class="page-title">Otimiza√ß√£o de Manejo</h1>
      <div class="alert alert-success">‚úÖ An√°lise completa realizada para 4 fazendas com potencial de economia total de R$ 892.450/ano</div>

      <div class="optimization-grid">
        <div class="optimization-card">
          <h3 style="margin-bottom:15px;color:#ef4444;">Cen√°rio Atual</h3>
          <div style="margin-bottom:15px;"><div style="color:#8892a0;font-size:14px;">Custo de Insumos</div><div style="font-size:24px;font-weight:600;">R$ 1.245/ha</div></div>
          <div style="margin-bottom:15px;"><div style="color:#8892a0;font-size:14px;">Qualidade M√©dia</div><div style="font-size:24px;font-weight:600;">76.5%</div></div>
          <div style="margin-bottom:15px;"><div style="color:#8892a0;font-size:14px;">Receita Estimada</div><div style="font-size:24px;font-weight:600;">R$ 8.450/ha</div></div>
          <div><div style="color:#8892a0;font-size:14px;">Margem L√≠quida</div><div style="font-size:24px;font-weight:600;">R$ 3.205/ha</div></div>
        </div>

        <div class="optimization-card recommended">
          <span class="recommended-badge">Recomendado</span>
          <h3 style="margin-bottom:15px;color:#10b981;">Cen√°rio Otimizado</h3>
          <div style="margin-bottom:15px;"><div style="color:#8892a0;font-size:14px;">Custo de Insumos</div><div style="font-size:24px;font-weight:600;">R$ 997/ha</div></div>
          <div style="margin-bottom:15px;"><div style="color:#8892a0;font-size:14px;">Qualidade M√©dia</div><div style="font-size:24px;font-weight:600;">84.2%</div></div>
          <div style="margin-bottom:15px;"><div style="color:#8892a0;font-size:14px;">Receita Estimada</div><div style="font-size:24px;font-weight:600;">R$ 9.820/ha</div></div>
          <div><div style="color:#8892a0;font-size:14px;">Margem L√≠quida</div><div style="font-size:24px;font-weight:600;color:#10b981;">R$ 4.823/ha</div></div>
        </div>
      </div>

      <div class="data-table" style="margin-top:30px;">
        <h3 style="margin-bottom:20px;">Recomenda√ß√µes por Fazenda</h3>
        <table>
          <thead>
            <tr><th>Fazenda</th><th>Talh√£o</th><th>A√ß√£o Recomendada</th><th>Impacto Qualidade</th><th>Economia (R$/ha)</th><th>ROI</th></tr>
          </thead>
          <tbody>
            <tr><td>Santa Helena</td><td>T-42</td><td>Reduzir N para 165 kg/ha</td><td><span class="positive">+2.3%</span></td><td>R$ 145</td><td><span class="positive">285%</span></td></tr>
            <tr><td>S√£o Jos√©</td><td>T-15</td><td>Aumentar P para 95 kg/ha</td><td><span class="positive">+3.8%</span></td><td>R$ 82</td><td><span class="positive">420%</span></td></tr>
            <tr><td>Boa Vista</td><td>T-08</td><td>Trocar variedade para FM 985</td><td><span class="positive">+5.2%</span></td><td>R$ 320</td><td><span class="positive">580%</span></td></tr>
            <tr><td>Nova Esperan√ßa</td><td>T-31</td><td>Ajustar densidade para 95k/ha</td><td><span class="positive">+1.9%</span></td><td>R$ 198</td><td><span class="positive">340%</span></td></tr>
          </tbody>
        </table>
      </div>

      <div style="text-align:center;margin-top:30px;">
        <button class="btn pulse" style="margin-right:15px;">Aplicar Recomenda√ß√µes</button>
        <button class="btn btn-secondary">Exportar Relat√≥rio</button>
      </div>
    </div>

    <!-- Relat√≥rio Qualidade -->
    <div id="relatorio-qualidade-section" class="content-section">
      <h1 class="page-title">Hist√≥rico de Qualidade</h1>
      <div class="report-card"><div class="report-title">Relat√≥rio Mensal - Mar√ßo 2024</div><div class="report-meta"><span>üìÖ 31/03/2024</span><span>üìä 142 amostras</span><span>‚úÖ Qualidade: 78.3%</span></div></div>
      <div class="report-card"><div class="report-title">Relat√≥rio Mensal - Fevereiro 2024</div><div class="report-meta"><span>üìÖ 29/02/2024</span><span>üìä 138 amostras</span><span>‚úÖ Qualidade: 77.8%</span></div></div>
      <div class="report-card"><div class="report-title">Relat√≥rio Mensal - Janeiro 2024</div><div class="report-meta"><span>üìÖ 31/01/2024</span><span>üìä 151 amostras</span><span>‚úÖ Qualidade: 76.9%</span></div></div>
      <div class="report-card"><div class="report-title">Relat√≥rio Anual - 2023</div><div class="report-meta"><span>üìÖ 31/12/2023</span><span>üìä 1.824 amostras</span><span>‚úÖ Qualidade: 75.2%</span></div></div>
    </div>

    <!-- Relat√≥rio Solo -->
    <div id="relatorio-solo-section" class="content-section">
      <h1 class="page-title">An√°lise Solo-Fibra</h1>
      <div class="chart-card">
        <div class="chart-title">Matriz de Correla√ß√£o Solo-Qualidade</div>
        <canvas id="soilMatrixChart"></canvas>
      </div>

      <div class="data-table" style="margin-top:30px;">
        <h3 style="margin-bottom:20px;">Correla√ß√µes Significativas</h3>
        <table>
          <thead><tr><th>Nutriente</th><th>Par√¢metro de Qualidade</th><th>Correla√ß√£o (r)</th><th>Signific√¢ncia</th><th>Interpreta√ß√£o</th></tr></thead>
          <tbody>
            <tr><td>Nitrog√™nio</td><td>Comprimento</td><td>0.72</td><td>p &lt; 0.001</td><td>Forte correla√ß√£o positiva</td></tr>
            <tr><td>F√≥sforo</td><td>Resist√™ncia</td><td>0.65</td><td>p &lt; 0.001</td><td>Correla√ß√£o positiva moderada</td></tr>
            <tr><td>Pot√°ssio</td><td>Uniformidade</td><td>0.58</td><td>p &lt; 0.01</td><td>Correla√ß√£o positiva moderada</td></tr>
            <tr><td>pH</td><td>Micronaire</td><td>-0.42</td><td>p &lt; 0.05</td><td>Correla√ß√£o negativa fraca</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Relat√≥rio ROI -->
    <div id="relatorio-roi-section" class="content-section">
      <h1 class="page-title">ROI por Fazenda</h1>

      <div class="metrics-grid">
        <div class="metric-card green"><div class="metric-label">ROI Total Portfolio</div><div class="metric-value">342%</div><div class="metric-change positive">‚Üë 45% vs ano anterior</div></div>
        <div class="metric-card blue"><div class="metric-label">Economia Total</div><div class="metric-value">R$ 892k</div><div class="metric-change">Projetado anual</div></div>
        <div class="metric-card yellow"><div class="metric-label">Payback</div><div class="metric-value">3.2 meses</div><div class="metric-change">Tempo de retorno</div></div>
        <div class="metric-card green"><div class="metric-label">VPL (5 anos)</div><div class="metric-value">R$ 3.8M</div><div class="metric-change">Taxa: 12% a.a.</div></div>
      </div>

      <div class="chart-card">
        <div class="chart-title">ROI por Fazenda (√öltimos 12 Meses)</div>
        <canvas id="roiChart"></canvas>
      </div>

      <div class="data-table" style="margin-top:30px;">
        <h3 style="margin-bottom:20px;">Detalhamento por Fazenda</h3>
        <table>
          <thead><tr><th>Fazenda</th><th>Investimento</th><th>Economia Realizada</th><th>Ganho Qualidade</th><th>ROI</th><th>Status</th></tr></thead>
          <tbody>
            <tr><td>Santa Helena</td><td>R$ 45.000</td><td>R$ 182.300</td><td>+8.2%</td><td>405%</td><td><span class="quality-indicator quality-high">Excelente</span></td></tr>
            <tr><td>S√£o Jos√©</td><td>R$ 38.000</td><td>R$ 145.200</td><td>+6.8%</td><td>382%</td><td><span class="quality-indicator quality-high">Excelente</span></td></tr>
            <tr><td>Boa Vista</td><td>R$ 52.000</td><td>R$ 156.800</td><td>+5.5%</td><td>302%</td><td><span class="quality-indicator quality-medium">Bom</span></td></tr>
            <tr><td>Nova Esperan√ßa</td><td>R$ 41.000</td><td>R$ 108.150</td><td>+4.2%</td><td>264%</td><td><span class="quality-indicator quality-medium">Bom</span></td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // ---------- Utilidades para cria√ß√£o somente quando o canvas tiver tamanho ----------
    const charts = { correlation:null, evolution:null, trends:null, sensitivity:null, soilMatrix:null, roi:null };

    function buildWhenSized(canvasId, key, builder){
      const el = document.getElementById(canvasId);
      if(!el) return;

      const tryBuild = () => {
        const rect = el.getBoundingClientRect();
        const section = el.closest('.content-section');
        const active = section && section.classList.contains('active');
        if(active && rect.width > 0 && rect.height > 0){
          if(charts[key]) { charts[key].destroy(); charts[key] = null; }
          charts[key] = builder(el.getContext('2d'));
          ro.disconnect();
        }
      };

      const ro = new ResizeObserver(tryBuild);
      ro.observe(el);
      // primeira tentativa imediata
      tryBuild();
    }

    // ---------- Criadores ----------
    function createDashboardCharts(){
      buildWhenSized('correlationChart','correlation',(ctx)=> new Chart(ctx,{
        type:'scatter',
        data:{datasets:[
          {label:'Santa Helena',data:[{x:140,y:27.5},{x:150,y:28.2},{x:160,y:28.9},{x:170,y:29.4},{x:180,y:29.8},{x:190,y:30.1}],backgroundColor:'#00d4ff',borderColor:'#00d4ff'},
          {label:'S√£o Jos√©',data:[{x:130,y:26.8},{x:140,y:27.3},{x:150,y:27.9},{x:160,y:28.5},{x:170,y:29.0},{x:180,y:29.3}],backgroundColor:'#10b981',borderColor:'#10b981'},
          {label:'Boa Vista',data:[{x:120,y:26.0},{x:130,y:26.5},{x:140,y:27.0},{x:145,y:27.2},{x:150,y:27.5},{x:160,y:28.0}],backgroundColor:'#ef4444',borderColor:'#ef4444'}
        ]},
        options:{
          responsive:true,maintainAspectRatio:false,
          plugins:{legend:{labels:{color:'#fff'}}},
          scales:{
            x:{title:{display:true,text:'Nitrog√™nio (kg/ha)',color:'#8892a0'},grid:{color:'#2a3547'},ticks:{color:'#8892a0'},min:110,max:200},
            y:{title:{display:true,text:'Comprimento da Fibra (mm)',color:'#8892a0'},grid:{color:'#2a3547'},ticks:{color:'#8892a0'},min:25,max:31}
          }
        }
      }));

      buildWhenSized('evolutionChart','evolution',(ctx)=> new Chart(ctx,{
        type:'line',
        data:{
          labels:['Jan/22','Jul/22','Jan/23','Jul/23','Jan/24','Jul/24'],
          datasets:[
            {label:'Qualidade Real',data:[72,73.5,74.2,75.8,76.5,77.2],borderColor:'#ef4444',backgroundColor:'rgba(239,68,68,.1)',tension:.4},
            {label:'Qualidade Predita',data:[72,74.5,76.8,79.2,81.5,84.2],borderColor:'#10b981',backgroundColor:'rgba(16,185,129,.1)',tension:.4}
          ]
        },
        options:{
          responsive:true,maintainAspectRatio:false,
          plugins:{legend:{labels:{color:'#fff'}}},
          scales:{
            x:{grid:{color:'#2a3547'},ticks:{color:'#8892a0'}},
            y:{title:{display:true,text:'√çndice de Qualidade (%)',color:'#8892a0'},grid:{color:'#2a3547'},ticks:{color:'#8892a0'},min:70,max:90}
          }
        }
      }));
    }

    function createHistoricoCharts(){
      buildWhenSized('trendsChart','trends',(ctx)=> new Chart(ctx,{
        type:'line',
        data:{
          labels:['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],
          datasets:[
            {label:'Comprimento',data:[27.5,27.8,28.1,28.3,28.5,28.7,28.9,29.0,29.2,29.3,29.4,29.5],borderColor:'#00d4ff',tension:.4},
            {label:'Resist√™ncia',data:[28.5,28.8,29.2,29.5,29.8,30.1,30.3,30.5,30.7,30.9,31.0,31.2],borderColor:'#10b981',tension:.4},
            {label:'Uniformidade',data:[80.2,80.5,80.8,81.2,81.5,81.8,82.0,82.3,82.5,82.7,82.9,83.0],borderColor:'#eab308',tension:.4}
          ]
        },
        options:{
          responsive:true,maintainAspectRatio:false,
          plugins:{legend:{labels:{color:'#fff'}}},
          scales:{x:{grid:{color:'#2a3547'},ticks:{color:'#8892a0'}},y:{grid:{color:'#2a3547'},ticks:{color:'#8892a0'}}}
        }
      }));
    }

    function createPredicaoCharts(){
      buildWhenSized('sensitivityChart','sensitivity',(ctx)=> new Chart(ctx,{
        type:'bar',
        data:{labels:['Nitrog√™nio','F√≥sforo','Pot√°ssio','pH','Irriga√ß√£o','Densidade'],
          datasets:[{label:'Impacto na Qualidade (%)',data:[8.5,6.2,4.8,3.5,7.2,2.9],backgroundColor:['#00d4ff','#10b981','#eab308','#ef4444','#3b82f6','#a855f7']}]},
        options:{
          responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},
          scales:{x:{grid:{color:'#2a3547'},ticks:{color:'#8892a0'}},
                  y:{title:{display:true,text:'Impacto (%)',color:'#8892a0'},grid:{color:'#2a3547'},ticks:{color:'#8892a0'}}}
        }
      }));
    }

    function createRelatorioSoloCharts(){
      buildWhenSized('soilMatrixChart','soilMatrix',(ctx)=> new Chart(ctx,{
        type:'bubble',
        data:{datasets:[
          {label:'N √ó Comprimento',data:[{x:1,y:1,r:15}],backgroundColor:'rgba(0,212,255,.6)'},
          {label:'P √ó Resist√™ncia',data:[{x:2,y:2,r:13}],backgroundColor:'rgba(16,185,129,.6)'},
          {label:'K √ó Uniformidade',data:[{x:3,y:3,r:11}],backgroundColor:'rgba(234,179,8,.6)'},
          {label:'pH √ó Micronaire',data:[{x:4,y:4,r:8}],backgroundColor:'rgba(239,68,68,.6)'}
        ]},
        options:{
          responsive:true,maintainAspectRatio:false,
          plugins:{legend:{labels:{color:'#fff'}}},
          scales:{
            x:{title:{display:true,text:'Nutriente',color:'#8892a0'},grid:{color:'#2a3547'},
               min:0,max:5,ticks:{stepSize:1,color:'#8892a0',callback:(v)=>(['','N','P','K','pH'][v]??'')}},
            y:{title:{display:true,text:'Par√¢metro',color:'#8892a0'},grid:{color:'#2a3547'},
               min:0,max:5,ticks:{stepSize:1,color:'#8892a0',callback:(v)=>(['','Comp.','Resist.','Unif.','Micro.'][v]??'')}}
          }
        }
      }));
    }

    function createRelatorioROICharts(){
      buildWhenSized('roiChart','roi',(ctx)=> new Chart(ctx,{
        type:'bar',
        data:{labels:['Santa Helena','S√£o Jos√©','Boa Vista','Nova Esperan√ßa'],
          datasets:[{label:'ROI (%)',data:[405,382,302,264],backgroundColor:['#10b981','#10b981','#eab308','#eab308']}]},
        options:{
          responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},
          scales:{
            x:{grid:{color:'#2a3547'},ticks:{color:'#8892a0'}},
            y:{title:{display:true,text:'ROI (%)',color:'#8892a0'},grid:{color:'#2a3547'},ticks:{color:'#8892a0'},min:0,max:500}
          }
        }
      }));
    }

    function initializeChartsForSection(section){
      if(section==='dashboard') createDashboardCharts();
      if(section==='historico') createHistoricoCharts();
      if(section==='predicao') createPredicaoCharts();
      if(section==='relatorio-solo') createRelatorioSoloCharts();
      if(section==='relatorio-roi') createRelatorioROICharts();
    }

    // ---------- Navega√ß√£o ----------
    function showSection(evt, sectionName){
      document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
      document.querySelectorAll('.menu-item').forEach(i=>i.classList.remove('active'));

      const target = document.getElementById(sectionName+'-section');
      if(target) target.classList.add('active');
      if(evt && evt.currentTarget) evt.currentTarget.classList.add('active');

      // cria gr√°ficos apenas da se√ß√£o atual (ser√£o criados quando o canvas tiver tamanho)
      initializeChartsForSection(sectionName);
    }

    // ---------- Predi√ß√£o ----------
    function updatePrediction(){
      const n=Number(document.getElementById('nitrogen-pred').value);
      const p=Number(document.getElementById('phosphorus-pred').value);
      const k=Number(document.getElementById('potassium-pred').value);
      const ph=Number(document.getElementById('ph-pred').value);
      const density=Number(document.getElementById('density-pred').value);
      const irrigation=Number(document.getElementById('irrigation-pred').value);

      document.getElementById('nitrogen-pred-value').textContent=n;
      document.getElementById('phosphorus-pred-value').textContent=p;
      document.getElementById('potassium-pred-value').textContent=k;
      document.getElementById('ph-pred-value').textContent=(ph/10).toFixed(1);
      document.getElementById('density-pred-value').textContent=(density/1000)+'k';
      document.getElementById('irrigation-pred-value').textContent=irrigation;

      const baseLength=27.0, baseStrength=28.0, baseMicronaire=4.5, baseUniformity=81.4;
      const length=Number((baseLength + n*0.015 + p*0.008 + k*0.005 + (irrigation-600)*0.001).toFixed(1));
      const strength=Number((baseStrength + n*0.018 + p*0.010 + k*0.007 + (density-110000)*0.00001).toFixed(1));
      const micronaire=Number((baseMicronaire - n*0.002 + p*0.001 - (ph-62)*0.01).toFixed(1));
      const uniformity=Number((baseUniformity + k*0.02 + (irrigation-600)*0.002).toFixed(1));

      document.getElementById('length-pred-result').textContent=length;
      document.getElementById('strength-pred-result').textContent=strength;
      document.getElementById('micronaire-pred-result').textContent=micronaire;
      document.getElementById('uniformity-pred-result').textContent=uniformity;

      const lengthChange=((length-baseLength)/baseLength*100).toFixed(1);
      const strengthChange=((strength-baseStrength)/baseStrength*100).toFixed(1);
      const uniformityChange=((uniformity-baseUniformity)/baseUniformity*100).toFixed(1);

      const lenEl=document.getElementById('length-pred-change');
      lenEl.textContent = lengthChange>0 ? `‚Üë ${lengthChange}%` : `‚Üì ${Math.abs(lengthChange)}%`;
      lenEl.className = lengthChange>0 ? 'result-change positive' : 'result-change negative';

      const strEl=document.getElementById('strength-pred-change');
      strEl.textContent = strengthChange>0 ? `‚Üë ${strengthChange}%` : `‚Üì ${Math.abs(strengthChange)}%`;
      strEl.className = strengthChange>0 ? 'result-change positive' : 'result-change negative';

      const uniEl=document.getElementById('uniformity-pred-change');
      uniEl.textContent = uniformityChange>0 ? `‚Üë ${uniformityChange}%` : `‚Üì ${Math.abs(uniformityChange)}%`;
      uniEl.className = uniformityChange>0 ? 'result-change positive' : 'result-change negative';

      const micStatus = (micronaire>=3.8 && micronaire<=4.5) ? 'Ideal' : (micronaire<3.8 ? 'Baixo' : 'Alto');
      const micEl=document.getElementById('micronaire-pred-change');
      micEl.textContent=micStatus;
      micEl.style.color = micStatus==='Ideal' ? '#10b981' : '#eab308';
    }

    // ---------- Boot ----------
    window.addEventListener('load',()=>{
      // inicializa apenas gr√°ficos do dashboard; os demais surgem quando a aba for aberta e o canvas tiver tamanho
      initializeChartsForSection('dashboard');
    });
  </script>
</body>
</html>
